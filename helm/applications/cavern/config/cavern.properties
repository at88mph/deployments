# service identity
org.opencadc.cavern.resourceID = {{ .Values.deployment.cavern.resourceID }}

# base directory for cavern files
org.opencadc.cavern.filesystem.baseDir = {{ .Values.deployment.cavern.filesystem.dataDir }}

# This subpath needs to match the subpath in Skaha's deployment.  If that one is configurable, so must this one be!
org.opencadc.cavern.filesystem.subPath = {{ .Values.deployment.cavern.filesystem.subPath }}

org.opencadc.cavern.nodes.QuotaPlugin = {{ .Values.deployment.cavern.quotaPlugin }}

{{ $allocations := required ".Values.deployment.cavern.allocations is required." .Values.deployment.cavern.allocations }}

{{- with $allocations }}
org.opencadc.cavern.defaultQuotaGB = {{ .defaultSizeGB | required "defaultSizeGB is required in .Values.deployment.cavern.allocations.defaultSizeGB" }}

{{ $parentFolders := required "at least one parent folder is required in .Values.deployment.cavern.allocations.parentFolders.  Don't modify this unless you're absolutely sure!" .parentFolders }}
{{ range $parentFolders }}
# Required folders.  This will check for the existence of them, and create if necessary.
org.opencadc.cavern.allocationParent = {{ . }}
{{- end }}
{{- end }}

# (optional) API Keys with administrative privileges to create User Allocations.
{{- range $clientName, $apiKey := .Values.deployment.cavern.adminAPIKeys }}
org.opencadc.cavern.adminAPIKey = {{ printf "%s:%s" $clientName $apiKey }}
{{- end }}

{{- with .Values.deployment.cavern.filesystem.rootOwner }}
# owner of root node has admin power
org.opencadc.cavern.filesystem.rootOwner = {{ .adminUsername }}

# (optional) username, uid, and gid (default) of the root owner
{{- if .username }}
org.opencadc.cavern.filesystem.rootOwner.username = {{ .username }}
{{- else }}
{{- required "value for .Values.deployment.cavern.filesystem.rootOwner.username is required." "" }}
{{- end }}

{{- if .uid }}
org.opencadc.cavern.filesystem.rootOwner.uid = {{ .uid }}
{{- else }}
{{- required "value for .Values.deployment.cavern.filesystem.rootOwner.uid is required." "" }}
{{- end }}

{{- if .gid }}
org.opencadc.cavern.filesystem.rootOwner.gid = {{ .gid }}
{{- else }}
{{- required "value for .Values.deployment.cavern.filesystem.rootOwner.gid is required." "" }}
{{- end }}

{{- end }}

{{- with .Values.deployment.cavern.sshfs }}
# (optional) base directory exposed for sshfs mounts
# {server}[:{port}]:{path}
org.opencadc.cavern.sshfs.serverBase = {{ .serverBase }}
{{- end }}
